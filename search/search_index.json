{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"ABS-KoSync Enhanced","text":"**The ultimate bridge for cross-platform reading and listening synchronization.**  [Getting Started](getting-started.md){ .md-button .md-button--primary } [View on GitHub](https://github.com/cporcellijr/abs-kosync-bridge){ .md-button }"},{"location":"#what-is-it","title":"\ud83d\udcd6 What is it?","text":"<p>ABS-KoSync Enhanced is a powerful, automated synchronization engine designed to unify your reading and listening experiences. It bridges the gap between audiobooks and ebooks, ensuring that whether you're listening on the go or reading on your e-reader, your progress is always perfectly aligned.</p>"},{"location":"#five-way-synchronization","title":"\ud83d\udd04 Five-Way Synchronization","text":"<p>The system keeps your progress in sync across all major platforms:</p> Platform Type Capability Audiobookshelf Audiobooks Full Read/Write Sync KOReader / KOSync Ebooks Full Read/Write Sync Storyteller Enhanced Reader Full Read/Write Sync (REST API &amp; SQLite) Booklore Library Management Full Read/Write Sync Hardcover.app Book Tracking Write-Only Tracking (Auto-Update Finished Status)"},{"location":"#features","title":"\u2728 Features","text":""},{"location":"#core-sync-engine","title":"\ud83d\ude80 Core Sync Engine","text":"<ul> <li>AI-Powered Alignment: Uses Whisper AI transcription to accurately map audio timestamps to ebook text.</li> <li>Multi-Platform Support: Synchronize progress across five different ecosystems simultaneously.</li> <li>Smart Conflict Resolution: \"Furthest progress wins\" logic with built-in anti-regression protection.</li> <li>Rich Positioning: Support for XPath, CSS selectors, and EPUB CFI for pixel-perfect positioning.</li> <li>Resumable Jobs: Background transcription jobs resume automatically if interrupted.</li> </ul>"},{"location":"#management-web-ui","title":"\ud83d\udda5\ufe0f Management Web UI","text":"<ul> <li>Real-Time Dashboard: Monitor progress and sync status across all your books.</li> <li>Advanced Matcher: Manual mapping for complex titles or different editions.</li> <li>Batch Processing: Queue and process multiple books for synchronization in bulk.</li> <li>Book Linker: Automated workflow for Storyteller readaloud generation.</li> <li>Dynamic Settings: Configure your entire system from the Web UI with instant hot-reloading.</li> </ul>"},{"location":"#automation-reliability","title":"\ud83e\udd16 Automation &amp; Reliability","text":"<ul> <li>Background Daemon: Configurable sync intervals for hands-off operation.</li> <li>Auto-Organization: Automatic addition to ABS collections and Booklore shelves.</li> <li>Error Recovery: Automatic retry logic for failed transcription or sync tasks.</li> </ul>"},{"location":"#how-it-works","title":"\ud83d\udee0\ufe0f How It Works","text":""},{"location":"#how-it-works_1","title":"\ud83d\udee0\ufe0f How It Works","text":"<p>The sync engine operates on a sophisticated event-driven architecture (V2):</p> <ol> <li>Triggers: Changes are detected via Instant Pushes (Internal KOSync) or Periodic Polling (ABS/Booklore).</li> <li>Normalization: Progress from all clients is normalized into a common format (timestamp or percentage).</li> <li>Discrepancy Check: The system identifies if a significant change has occurred.</li> <li>Leader Election: The client with the most recent explicit progress becomes the \"Leader\".</li> <li>Translation: If the Leader is an Audiobook and followers are Ebooks (or vice-versa), the system uses Whisper AI transcripts to translate the timestamp into an exact text position (or vice versa).</li> <li>Propagation: The new position is sent to all other configured clients.</li> </ol> <pre><code>graph TD\n    A[Start Sync Cycle] --&gt; B{Trigger?}\n    B --&gt;|Poll Timer| C[Fetch Progress (All Clients)]\n    B --&gt;|Instance Sync| C\n    B --&gt;|KoSync Push| C\n    C --&gt; D[Normalize Positions]\n    D --&gt; E{Leader Check}\n    E --&gt;|Significant Delta| F[Identify Leader]\n    E --&gt;|No Change| A\n    F --&gt; G{Format Mismatch?}\n    G --&gt;|Yes| H[Audio &lt;--&gt; Text Translation]\n    G --&gt;|No| I[Direct Sync]\n    H --&gt; J[Calculate New Position]\n    I --&gt; J\n    J --&gt; K[Update Follower Clients]\n    K --&gt; L[Save State to DB]\n    L --&gt; A\n</code></pre> <p>Audio to Text Conversion</p> <p>The system extracts a snippet of text from the audiobook transcript at the current timestamp and performs a fuzzy search within the EPUB to find the corresponding ebook location.</p>"},{"location":"changelog/","title":"Changelog","text":"<p>For the most up-to-date changes, features, and bug fixes, please refer to the GitHub Releases page.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>[!NOTE] All configuration is managed via the Web UI at <code>/settings</code>.  Environment variables can be used for initial bootstrapping, but values set in the database (via UI) take precedence.</p>"},{"location":"configuration/#web-ui-settings","title":"Web UI Settings","text":"<p>The most convenient way to manage configuration is via the Settings page in the Web UI. Changes made here are applied instantly (triggering a soft restart).</p>"},{"location":"configuration/#integrations","title":"Integrations","text":""},{"location":"configuration/#kosync-koreader","title":"KOSync (KOReader)","text":"<ul> <li>Server: Your KOSync server URL (e.g., <code>https://koreader.mydomain.com/api/koreader</code>).</li> <li>Username: Your KOSync username.</li> <li>Password: Your KOSync password.</li> <li>Save Hash Method: How KOReader calculates document integrity. Keep as default (<code>content</code>) unless you know what you're doing.</li> </ul>"},{"location":"configuration/#storyteller","title":"Storyteller","text":"<ul> <li>Storyteller URL: URL to your Storyteller instance.</li> <li>Storyteller API Key: Your API key (if required).</li> <li>Sync Mode: REST API (default).</li> </ul>"},{"location":"configuration/#booklore","title":"Booklore","text":"<ul> <li>Booklore URL: URL to your Booklore/Calibre-Web instance.</li> <li>API Key: For managing shelves/collections.</li> </ul>"},{"location":"configuration/#transcription-settings","title":"Transcription Settings","text":"<p>Configure the engine used for audio-to-text alignment.</p> Setting Default Description Provider <code>local</code> <code>local</code> (faster-whisper), <code>deepgram</code>, or <code>whisper_cpp</code> (via server). Whisper Model <code>tiny</code> Model size (<code>tiny</code>, <code>base</code>, <code>small</code>, <code>medium</code>, <code>large</code>). Whisper Device <code>auto</code> <code>auto</code>, <code>cpu</code>, or <code>cuda</code>. See GPU Support below. Compute Type <code>auto</code> Precision (<code>int8</code>, <code>float16</code>, <code>float32</code>). Use <code>float16</code> for GPU."},{"location":"configuration/#deepgram","title":"Deepgram","text":"<ul> <li>API Key: Your Deepgram API Key.</li> <li>Model: Specific Deepgram model tier (e.g., <code>nova-2</code>).</li> </ul>"},{"location":"configuration/#whispercpp","title":"WhisperCPP","text":"<ul> <li>Server URL: URL to your running <code>whisper.cpp</code> server if using that provider.</li> </ul>"},{"location":"configuration/#sync-tuning","title":"Sync Tuning","text":"<p>Advanced settings to fine-tune the synchronization logic.</p> Setting Default Description Sync Period (Minutes) <code>5</code> How often the background sync runs. ABS Delta (Seconds) <code>30</code> Minimum progress change (in seconds) required to trigger an update from ABS. KoSync Delta (%) <code>0.005</code> Minimum progress change (0.5%) required to trigger an update from KOReader. Fuzzy Match Threshold <code>0.80</code> (0.0-1.0) Confidence required for text matching (80%). Job Retries <code>5</code> How many times to retry failed transcription jobs."},{"location":"configuration/#book-linker-filesystem","title":"Book Linker (Filesystem)","text":"<p>Required only if using the Book Linker tool to prepare files for Storyteller.</p> Variable Default Description <code>LINKER_BOOKS_DIR</code> <code>/linker_books</code> Source directory for ebooks. <code>AUDIOBOOKS_DIR</code> <code>/audiobooks</code> Source directory for audiobooks (usually read-only). <code>PROCESSING_DIR</code> <code>/processing</code> Temporary working directory for copying files. <code>STORYTELLER_INGEST_DIR</code> <code>/linker_books</code> Destination directory where Storyteller picks up new books."},{"location":"configuration/#toggles","title":"Toggles","text":"<ul> <li>Sync ABS Ebook: If enabled, also syncs progress to the ebook item in ABS (if you have both mapped). This allows you to read the ebook in the ABS web reader and have that progress sync to KOReader.</li> <li>XPath Fallback: Strategy for handling position lookups when exact paths fail.</li> </ul>"},{"location":"configuration/#gpu-support-optional","title":"GPU Support (Optional)","text":"<p>For significantly faster transcription (when using <code>local</code> provider), you can enable NVIDIA GPU acceleration.</p>"},{"location":"configuration/#1-install-nvidia-container-toolkit","title":"1. Install NVIDIA Container Toolkit","text":"<p>Follow the official guide to install the NVIDIA Container Toolkit for your host OS.</p>"},{"location":"configuration/#2-update-docker-compose","title":"2. Update Docker Compose","text":"<p>Uncomment/Add the <code>deploy</code> section to your <code>docker-compose.yml</code>:</p> <pre><code>services:\n  abs-kosync:\n    # ... other config ...\n    deploy:\n      resources:\n        reservations:\n          devices:\n            - driver: nvidia\n              count: 1\n              capabilities: [gpu]\n</code></pre>"},{"location":"configuration/#3-configure-settings","title":"3. Configure Settings","text":"<p>In the Web UI Settings: 1. Set Whisper Device to <code>cuda</code>. 2. Set Whisper Compute Type to <code>float16</code>. 3. Set Whisper Model to <code>small</code> or <code>medium</code> (GPUs can handle larger models easily).</p>"},{"location":"getting-started/","title":"Getting Started","text":""},{"location":"getting-started/#goal","title":"\ud83c\udfaf Goal","text":"<p>Get your audiobooks and ebooks syncing in 10 minutes!</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following:</p> <ul> <li>Docker and Docker Compose installed.</li> <li>An Audiobookshelf server running.</li> <li>(Optional) A Booklore instance (for syncing ebooks).</li> <li>(Optional) A KOReader sync server (either the official one, a self-hosted instance, or none if just syncing ABS &lt;-&gt; Storyteller).</li> <li>Your ebook and audiobook files accessible to the host machine.</li> </ul>"},{"location":"getting-started/#step-1-get-your-api-keys","title":"Step 1: Get Your API Keys","text":""},{"location":"getting-started/#audiobookshelf-api-key","title":"Audiobookshelf API Key","text":"<ol> <li>Log into your ABS server.</li> <li>Go to Settings \u2192 Users \u2192 Your user.</li> <li>Click \"Generate API Token\".</li> <li>Copy the token.</li> </ol>"},{"location":"getting-started/#optional-find-your-abs-library-id","title":"(Optional) Find Your ABS Library ID","text":"<p>If you want to limit the sync mapping search to a specific library (recommended for performance): 1. In ABS, go to your audiobook library. 2. Look at the URL: <code>https://your-server.com/library/LIBRARY_ID_HERE</code> 3. Copy that ID.</p>"},{"location":"getting-started/#optional-kosync-credentials","title":"(Optional) KOSync Credentials","text":"<p>If using KOReader sync: - Your Calibre/KOSync username and password. - KOSync server URL (usually <code>https://your-calibre.com/api/koreader</code>).</p>"},{"location":"getting-started/#optional-booklore-credentials","title":"(Optional) Booklore Credentials","text":"<p>If using Booklore: - Your Booklore server URL. - Username and password.</p>"},{"location":"getting-started/#step-2-prepare-your-work-directory","title":"Step 2: Prepare Your Work Directory","text":"<p>Create a directory for the application on your server:</p> <pre><code>mkdir ~/abs-kosync\ncd ~/abs-kosync\nmkdir data\n</code></pre>"},{"location":"getting-started/#step-3-create-docker-composeyml","title":"Step 3: Create docker-compose.yml","text":"<p>Copy this template and fill in YOUR values:</p> docker-compose.yml<pre><code>services:\n  abs-kosync:\n    image: ghcr.io/cporcellijr/abs-kosync-bridge:latest\n    container_name: abs_kosync\n    restart: unless-stopped\n    ports:\n      - \"8080:5757\"\n    environment:\n      - TZ=America/New_York\n      - LOG_LEVEL=INFO\n\n      # NOTE: All configuration (ABS, etc.) is managed in the Web UI.\n\n    volumes:\n      # === REQUIRED ===\n      - ./data:/data                    # App data\n      - /path/to/ebooks:/books          # Your EPUB library\n\n      # === OPTIONAL: Book Linker ===\n      # - /path/to/downloads/ebooks:/linker_books\n      # - /path/to/downloads/audio:/audiobooks\n      # - ./processing:/processing\n      # - /path/to/storyteller:/storyteller/library\n</code></pre> <p>Optional Integrations</p> <p>You can configure KOSync, Storyteller, and other integrations via enviroment variables during bootstrap, but it is easier to do it later in the Web UI!</p>"},{"location":"getting-started/#step-4-start-the-service","title":"Step 4: Start the Service","text":"<pre><code>docker compose up -d\n</code></pre> <p>Check the logs to ensure everything is running smoothly:</p> <pre><code>docker compose logs -f\n</code></pre>"},{"location":"getting-started/#step-5-initial-configuration","title":"Step 5: Initial Configuration","text":"<ol> <li>Open your browser and go to <code>http://localhost:8080/settings</code> (or your server IP).</li> <li>Enter your Audiobookshelf Server URL and API Key (from Step 1).</li> <li>(Optional) Enter your KOSync, Booklore, or Storyteller credentials.</li> <li>Click Save Settings. The application will restart automatically to apply changes.</li> </ol>"},{"location":"getting-started/#step-6-create-your-first-mapping","title":"Step 6: Create Your First Mapping","text":"<ol> <li>Go to the Match page (or click \"Single Match\" on the dashboard).</li> <li>Search for an audiobook in your ABS library.</li> <li>Select the corresponding ebook file from the list.</li> <li>Click Create Mapping.</li> </ol> <p>That's it! The system will now automatically sync progress between your audiobook and ebook every 5 minutes (default).</p>"},{"location":"troubleshooting/","title":"Troubleshooting","text":""},{"location":"troubleshooting/#common-issues","title":"Common Issues","text":""},{"location":"troubleshooting/#books-not-showing-up","title":"Books not showing up?","text":"<ul> <li>Check Volumes: Ensure your <code>/books</code> volume is correctly mounted in <code>docker-compose.yml</code>. The path inside the container must match where you are looking.</li> <li>Permissions: Ensure the user running the container has read permissions for the ebook files.</li> </ul>"},{"location":"troubleshooting/#transcription-taking-too-long","title":"Transcription taking too long?","text":"<ul> <li>Model Size: Try setting <code>WHISPER_MODEL=tiny</code> in the Settings page.</li> <li>Hardware: Transcription is CPU-intensive. If possible, enable GPU Acceleration.</li> </ul>"},{"location":"troubleshooting/#syncing-backwards","title":"Syncing backwards?","text":"<p>The system includes anti-regression logic, but if you switch devices rapidly, issues can occur. - Solution: Go to the Dashboard and click \"Reset Progress\" for the affected book. This clears the stored sync state without affecting your external accounts.</p>"},{"location":"troubleshooting/#logs","title":"Logs","text":"<p>Documentation and live logs are available directly in the Web UI. Alternatively, you can view them via the terminal:</p> <pre><code>docker compose logs -f\n</code></pre> <p>Look for lines starting with <code>[INFO]</code> or <code>[ERROR]</code>.</p>"},{"location":"troubleshooting/#gpu-acceleration","title":"GPU Acceleration","text":"<p>See the Configuration Guide for instructions on enabling NVIDIA GPU acceleration.</p>"},{"location":"user-guide/","title":"User Guide","text":"<p>This guide covers the features and workflows available in the ABS-KoSync Enhanced Web UI.</p>"},{"location":"user-guide/#dashboard","title":"Dashboard","text":"<p>The Dashboard is your command center. It shows:</p> <ul> <li>Active Syncs: A list of all books currently being tracked.</li> <li>Sync Status: Real-time progress bars for each book.</li> <li>Recent Activity: A log of the latest sync actions.</li> <li>Single Match: Manually link an audiobook to an ebook.</li> <li>Batch Match: Switch to the Batch Matcher view.</li> </ul>"},{"location":"user-guide/#sync-modes","title":"Sync Modes","text":"<p>When creating a mapping, the system operates in one of two modes:</p>"},{"location":"user-guide/#1-audiobook-sync-default","title":"1. Audiobook Sync (Default)","text":"<p>Links an Audiobook in ABS to an Ebook in KOReader (and other platforms). - Mechanism: Transcription-based alignment. - Use Case: Listening on phone, reading on Kindle/Kobo. - Process: Mapping creates a transcript of the audiobook, then uses that text to find the corresponding page in the ebook.</p>"},{"location":"user-guide/#2-ebook-only-sync","title":"2. Ebook-Only Sync","text":"<p>Links your ebook status across platforms. - Mechanism: Direct percentage/text position sync. - Triggers:     - Internal KOSync: Instant (Push-based).     - ABS/Booklore: Periodic Polling (every ~5 mins). - Supported Clients:     - KOReader (via Internal KOSync Server)     - Booklore (Requires <code>BOOKLORE_ENABLED=true</code>)     - ABS Ebook (Requires <code>SYNC_ABS_EBOOK=true</code>) - Hardcover: Updates Hardcover.app presence (if configured). - Note: If you only use Booklore and ABS Web Reader (no KOReader), syncs will occur only during the periodic poll interval.</p>"},{"location":"user-guide/#matcher","title":"Matcher","text":"<p>The Matcher allows you to link an Audiobookshelf audiobook to a specific EPUB file in your <code>/books</code> directory.</p>"},{"location":"user-guide/#single-match","title":"Single Match","text":"<ol> <li>Search: Type the name of the audiobook. The system queries your ABS library.</li> <li>Select Audio: Click on the correct audiobook result.</li> <li>Select Text: The system will list available EPUB files. Use the search bar to filter.</li> <li>Create Mapping: Click the button to confirms the link.</li> </ol>"},{"location":"user-guide/#batch-match","title":"Batch Match","text":"<p>For users with large libraries, the Batch Matcher speeds up the process.</p> <ol> <li>Queue: Add multiple books to the matching queue.</li> <li>Auto-Suggest: The system will attempt to find the best matching EPUB for each audiobook based on filename similarity.</li> <li>Confirm: Review the suggestions and confirm them in bulk.</li> </ol>"},{"location":"user-guide/#book-linker-storyteller-ingest","title":"Book Linker (Storyteller Ingest)","text":"<p>[!WARNING] The Book Linker is NOT a sync tool. It is a file management utility.</p> <p>The Book Linker is designed specifically to help you create \"Synced Books\" for Storyteller. It simplifies the process of getting the audio files and ebook files into the correct folder structure for Storyteller to ingest them.</p>"},{"location":"user-guide/#what-it-does","title":"What it does:","text":"<ol> <li>Finds Files: Locates the audio files in ABS and the ebook file in your local directory.</li> <li>Copies Files: Copies both to a temporary <code>/processing</code> folder.</li> <li>Triggers Ingest: Moves the folder to the Storyteller ingest directory, effectively telling Storyteller \"Here is a new book pair, please generate the text-audio alignment.\"</li> </ol>"},{"location":"user-guide/#when-to-use-it","title":"When to use it:","text":"<p>Use this feature ONLY if you want to use the Storyteller app's \"Read-Along\" feature (listening while the text highlights). If you just want to keep your place in sync between ABS and KOReader, you do not need the Book Linker.</p>"},{"location":"user-guide/#important-constraints","title":"Important Constraints","text":"<p>[!WARNING] No Process Started: The Book Linker is a passive file manager. It does NOT start or control any Storyteller process. It simply moves files to where Storyteller expects them.</p> <p>[!CAUTION] Volume Mapping (Storyteller V2): Storyteller V2 is stateful and tracks file paths. If you map <code>/processing</code> and <code>/storyteller/library</code> to different folders, you cause a conflict: 1. Bridge copies to <code>/processing</code>. Storyteller imports it (Path: <code>/processing/Book</code>). 2. Bridge moves it to <code>/storyteller/library</code>. Storyteller sees a \"new\" book. 3. Storyteller tries to open the old <code>/processing</code> path, which is now empty -&gt; Error 500.</p> <p>Best Practice: Ensure your processing workflows do not confuse Storyteller's database, or accept that manual cleanup in Storyteller may be required. Ideally, point Storyteller to watch the final destination, not the temporary processing folder.</p>"},{"location":"user-guide/#auto-discovery-internal-kosync-only","title":"Auto-Discovery (Internal KOSync Only)","text":"<p>If you configure your KOReader devices to sync directly to this bridge (using the Internal KOSync Server), the system can automatically detect and link books for you. This is the only way to automatically create Ebook-Only links without manual approval.</p>"},{"location":"user-guide/#how-it-works","title":"How it works","text":"<ol> <li>Push: You open a book in KOReader. It pushes progress to the bridge instantaneously.</li> <li>Match: The bridge looks for a matching audiobook in your ABS library.</li> <li>Action:<ul> <li>Audiobook Found: Creates a Suggestion on your Dashboard (requires approval).</li> <li>No Audiobook Found: Automatically creates an Ebook-Only Sync mapping, allowing immediate cross-device tracking.</li> </ul> </li> </ol> <p>[!IMPORTANT] Trigger Constraint: This \"Auto-Creation\" feature requires using the Internal KOSync Server. Polling traditional services (ABS/Booklore) will simply create Suggestions, which always require manual approval.</p>"},{"location":"user-guide/#suggestions","title":"Suggestions","text":"<p>The system can also intelligently suggest mappings based on activity, but these always require manual confirmation.</p> <p>Sources: 1.  Audiobookshelf (Periodic Polling): When the bridge sees you listening to an unmapped audiobook, it suggests a matching ebook. 2.  Internal KOSync (Push): When you read an unmapped ebook that does have a matching audiobook.</p> <p>Actions: - Review: Opens the Matcher pre-filled. - Dismiss: Removes the suggestion.</p>"},{"location":"user-guide/#management","title":"Management","text":""},{"location":"user-guide/#editing-mappings","title":"Editing Mappings","text":"<p>You can edit or delete existing mappings from the Dashboard. - Delete: Stops syncing the book. Does NOT delete the files. - Reset Progress: Clears the stored sync state if things get out of whack.</p>"},{"location":"user-guide/#viewing-logs","title":"Viewing Logs","text":"<p>Navigate to Logs in the sidebar to view the live application logs. This is useful for troubleshooting why a specific book might not be syncing.</p>"}]}